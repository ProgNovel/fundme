define(["exports"],function(t){"use strict";function e(t){return function(t,e){t?t.content=e:t=function(t){const e=document.createElement("meta");return e.name="monetization",e.content=t,document.head.appendChild(e),e}(e);return t}(document.querySelector('meta[name="monetization"]'),t)}function n(t){e(t)}const r="Fundme.js: default address not found. Use setDefaultAddress(str: string) to set it first.",o="Fundme.js: Invalid Web Monetization pointer address is given.",i="Fundme.js: address not found.",s="Fundme.js: address must be a string.";const u="Fundme.js: no monetization template is found.",a="Fundme.js: fails to parse address from <template data-fund></template>.",d="Fundme.js: cannot parse JSON from <script fundme>. Make sure it contains a valid JSON.",f="Fundme.js: found <script fundme> but it's not valid.",c='Fundme.js: found <script fundme> but its type is not "application/json"',l=5;function m(t){e(function(t){const e=t.address;if(!e)throw new Error(i);if("string"!=typeof e)throw new Error(s);return e}(function(t){let e=function(t){return Math.random()*t}(function(t){const e=t.map(t=>t.weight);return Object.values(e).reduce((t,e)=>t+e,0)}(t));return function(t,e){for(const n in t)if((e-=t[n].weight)<=0)return t[n]}(t,e)}(p(t))))}function p(t){return t.map(t=>{let e;if("string"==typeof t&&(t=w(t)),!("address"in t))throw new Error(i);return e=h(t)})}function h(t){return void 0!==t.weight&&NaN!==t.weight||(console.warn(`Fundme.js: ${t.address} has weight that is not a number. It has been set to ${l} (default).`),t.weight=l),t}function w(t){let e,n=t;const r=t.split("#");return r.length>1&&(n=r[0],e=parseInt(r[1],10)),{address:n,weight:e||l}}const g="template[data-fund]",y="template[fundme]",E="script[fundme]";function j(){const t=[...function(){const t=document.body.querySelectorAll(g);let e=[];t.length&&t.forEach(t=>{const n=function(t){let e=t.dataset.fund,n=void 0!==t.dataset.fundWeight?parseInt(t.dataset.fundWeight,0):l;if(!e)throw new Error(a);return h({address:e,weight:n})}(t);e=[...e,n]});return e}(),...function(){const t=document.body.querySelectorAll(E);let e=[];t.length&&t.forEach(t=>{e=function(t){let e,n=[];try{e=JSON.parse(t.innerHTML)}catch(t){throw new Error(d)}if("application/json"!==t.type)throw new Error(c);if(Array.isArray(e))n=p(e);else{if("string"!=typeof e)throw new Error(f);n=p([e])}return n}(t)});return e}(),...function(){const t=document.querySelectorAll(y);let e=[];t.length&&t.forEach(t=>{e=[...e,...function(t){let e=[];return t.innerHTML.split(";").forEach(t=>{const n=t.replace(/(^\s+|\s+$)/g,"");n&&(e=[...e,w(n)])}),e}(t)]});return e}()];if(!t.length)throw new Error(u);m(t)}let v,F;var A;function b(t){return F=t}!function(t){t.isSingle="single",t.isMultiple="multiple",t.isDefault="default",t.isFromTemplate="template",t.isUndefined="undefined"}(A||(A={})),t.fund=function(t,e){if("string"==typeof t){if("default"===t){if(void 0!==v)return"string"==typeof v?n(v):m(v),b(A.isDefault);throw new Error(r)}return n(t),b(A.isSingle)}if(i=t,Array.isArray(i))return m(t),b(A.isMultiple);var i;if(void 0===t)return j(),b(A.isFromTemplate);throw new Error(o)},t.setDefaultAddress=function(t){v=Array.isArray(t)?p(t):t},Object.defineProperty(t,"__esModule",{value:!0})});