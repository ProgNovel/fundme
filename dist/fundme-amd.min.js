define(["exports"],function(t){"use strict";function e(t){return"Fundme.js: "+t}const n="address not found.",r="address must be a string.",i="can't use getCurrentPointerAddress() server-side.";const o="invalid Web Monetization pointer address is given.",s="default address not found. Use setDefaultAddress(str: string) to set it first.",u="invalid default address.",a="invalid default address.",f="can only clean custom syntax with typeof string.",d="web monetization meta tag is not found.",c='multiple <meta name="monetization" /> found - Web Monetization API only support a single meta tag.',l="no monetization template is found.",m="fails to parse address from <template data-fund></template>.",h="cannot parse JSON from <script fundme>. Make sure it contains a valid JSON.",p="found <script fundme> but it's not valid.",g='found <script fundme> but its type is not "application/json"',y="can't use fund() with empty parameters in server side.",w="invalid fundme parameters on the server-side.",v=5;function A(t,e={}){const n=b(t),r=S(function(t){let e=function(t){return Math.random()*t}(function(t){const e=t.map(t=>t.weight||v);return Object.values(e).reduce((t,e)=>t+e,0)}(t));return function(t,e){for(const n in t){const r=t[n].weight||v;if((e-=r)<=0)return t[n]}return{address:""}}(t,e)}(n));return D(n),L(e)?q(r):r}function S(t){const i=t.address;if(!i)throw e(n);if("string"!=typeof i)throw e(r);return i}function b(t){return t.map(t=>{let r;if("string"==typeof t&&(t=z(t)),!O(t))throw e(n);return r=M(t)})}function M(t){return void 0!==t.weight&&NaN!==t.weight||(console.warn(`${t.address} has weight that is not a number. It has been set to ${v} (default).`),t.weight=v),t}function z(t){let e=t,n=v;const r=t.split("#");return r.length>1&&(e=r[0],r[1].endsWith("%")?(r[1],I()):n=parseInt(r[1],10)),M({address:e,weight:n})}function j(t){return Array.isArray(t)}function q(t){return function(t,e){t?t.content=e:t=function(t){const e=document.createElement("meta");return e.name="monetization",e.content=t,document.head.appendChild(e),e}(e);return t}(document.head.querySelector('meta[name="monetization"]'),t)}function O(t){return!!t&&Object.keys(t).some(t=>"address"===t)}let P,E,N;function W(){return P}function C(t){return E=t}function D(t){N=t}function I(){return function(t){Array.isArray(t)||void 0===t||(t=[t]);return t||[]}(N)}function T(t,n={}){return D(t=function(t){if("string"!=typeof t)throw e(f);return t=t.split("#")[0]}(t)),L(n)?q(t):t}const F="template[data-fund]",J="template[fundme]",U="script[fundme]";function $(t={}){const n=[...function(){const t=document.body.querySelectorAll(F);let n=[];t.length&&t.forEach(t=>{const r=function(t){let n=t.dataset.fund,r=void 0!==t.dataset.fundWeight?parseInt(t.dataset.fundWeight,0):v;if(!n)throw e(m);return M({address:n,weight:r})}(t);n=[...n,r]});return n}(),...function(){const t=document.body.querySelectorAll(U);let n=[];t.length&&t.forEach(t=>{n=function(t){let n,r=[];try{n=JSON.parse(t.innerHTML)}catch(t){throw e(h)}if("application/json"!==t.type)throw e(g);if(Array.isArray(n))r=b(n);else{if("string"!=typeof n)throw e(p);r=b([n])}return r}(t)});return n}(),...function(){const t=document.querySelectorAll(J);let e=[];t.length&&t.forEach(t=>{e=[...e,...function(t){let e=[];return t.innerHTML.split(";").forEach(t=>{const n=t.replace(/(^\s+|\s+$)/g,"");n&&(e=[...e,z(n)])}),e}(t)]});return e}()];if(!n.length)throw e(l);A(n,t)}function k(t,n={}){if(void 0===t)return $(),C(_.isFromTemplate);if("string"==typeof t){if("default"===t){if(void 0!==W())return"string"==typeof W()?T(W().toString(),n):A(j(r=W())?r:[r],n),C(_.isDefault);throw e(s)}return T(t,n),C(_.isSingle)}var r;if(j(t))return A(t,n),C(_.isMultiple);throw e(o)}let x=!1;const H=void 0!==require&&void 0!==module,L=(t={})=>{if("server"===t.force)return!1;const e=x;return x=!1,!H||e||"client"===t.force};var _;!function(t){t.isSingle="single",t.isMultiple="multiple",t.isDefault="default",t.isFromTemplate="template",t.isUndefined="undefined"}(_||(_={})),t.fund=function(t,n={}){if(L(n))return k(t,n);if(void 0===t)throw e(y);return function(t){if(void 0===t)throw e(y);if("string"==typeof t)return T(t).toString();if(j(t))return A(t).toString();throw e(w)}(t)},t.getCurrentPointerAddress=function(){if(L()){const t=document.head.querySelectorAll('meta[name="monetization"]');if(t.length>1)throw e(c);if(t[0])return t[0].content;throw e(d)}if(N)return N.toString();throw e(i)},t.getCurrentPointerPool=I,t.setDefaultAddress=function(t,n={}){if(Array.isArray(t)){if(t.length)return void(P=b(t));throw e(a)}if("string"!=typeof t)if(O(t))P=S(t);else{if(!n.allowUndefined||void 0!==t)throw e(u);P=void 0}else P=t},Object.defineProperty(t,"__esModule",{value:!0})});