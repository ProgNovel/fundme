define(["exports"],function(t){"use strict";function e(t){return"Fundme.js: "+t}const n="address not found.",r="address must be a string.",i="can't use getCurrentPointerAddress() server-side.";const o="invalid Web Monetization pointer address is given.",u="default address not found. Use setDefaultAddress(str: string) to set it first.",s="invalid default address.",a="invalid default address.",f="can only clean custom syntax with typeof string.",d="web monetization meta tag is not found.",c='multiple <meta name="monetization" /> found - Web Monetization API only support a single meta tag.',l="no monetization template is found.",m="fails to parse address from <template data-fund></template>.",p="cannot parse JSON from <script fundme>. Make sure it contains a valid JSON.",h="found <script fundme> but it's not valid.",g='found <script fundme> but its type is not "application/json"',y="can't use fund() with empty parameters in server side.",w="invalid fundme parameters on the server-side.",v=5;function A(t,e={}){const n=b(t),r=S(function(t){let e=function(t){return Math.random()*t}(function(t){const e=t.map(t=>t.weight);return Object.values(e).reduce((t,e)=>t+e,0)}(t));return function(t,e){for(const n in t){const r=t[n].weight;if((e-=r)<=0)return t[n]}}(t,e)}(n));return I(n),H(e)?q(r):r}function S(t){const i=t.address;if(!i)throw e(n);if("string"!=typeof i)throw e(r);return i}function b(t){return t.map(t=>{let r;if("string"==typeof t&&(t=z(t)),!O(t))throw e(n);return r=M(t)})}function M(t){return void 0!==t.weight&&NaN!==t.weight||(console.warn(`${t.address} has weight that is not a number. It has been set to ${v} (default).`),t.weight=v),t}function z(t){let e,n=t;const r=t.split("#");return r.length>1&&(n=r[0],e=parseInt(r[1],10)),M({address:n,weight:e})}function j(t){return Array.isArray(t)}function q(t){return function(t,e){t?t.content=e:t=function(t){const e=document.createElement("meta");return e.name="monetization",e.content=t,document.head.appendChild(e),e}(e);return t}(document.querySelector('meta[name="monetization"]'),t)}function O(t){return!!t&&Object.keys(t).some(t=>"address"===t)}let P,E,N;function C(){return P}function D(t){return E=t}function I(t){N=t}function T(t,n={}){return I(t=function(t){if("string"!=typeof t)throw e(f);return t=t.split("#")[0]}(t)),H(n)?q(t):t}const W="template[data-fund]",F="template[fundme]",J="script[fundme]";function U(t={}){const n=[...function(){const t=document.body.querySelectorAll(W);let n=[];t.length&&t.forEach(t=>{const r=function(t){let n=t.dataset.fund,r=void 0!==t.dataset.fundWeight?parseInt(t.dataset.fundWeight,0):v;if(!n)throw e(m);return M({address:n,weight:r})}(t);n=[...n,r]});return n}(),...function(){const t=document.body.querySelectorAll(J);let n=[];t.length&&t.forEach(t=>{n=function(t){let n,r=[];try{n=JSON.parse(t.innerHTML)}catch(t){throw e(p)}if("application/json"!==t.type)throw e(g);if(Array.isArray(n))r=b(n);else{if("string"!=typeof n)throw e(h);r=b([n])}return r}(t)});return n}(),...function(){const t=document.querySelectorAll(F);let e=[];t.length&&t.forEach(t=>{e=[...e,...function(t){let e=[];return t.innerHTML.split(";").forEach(t=>{const n=t.replace(/(^\s+|\s+$)/g,"");n&&(e=[...e,z(n)])}),e}(t)]});return e}()];if(!n.length)throw e(l);A(n,t)}function $(t,n={}){if("string"==typeof t){if("default"===t){if(void 0!==C())return"string"==typeof C()?T(C().toString(),n):A(j(r=C())?r:[r],n),D(L.isDefault);throw e(u)}return T(t,n),D(L.isSingle)}var r;if(j(t))return A(t,n),D(L.isMultiple);if(void 0===t)return U(),D(L.isFromTemplate);throw e(o)}let k=!1;const x=void 0!==require&&void 0!==module,H=(t={})=>{if("server"===t.force)return!1;const e=k;return k=!1,!x||e||"client"===t.force};var L;!function(t){t.isSingle="single",t.isMultiple="multiple",t.isDefault="default",t.isFromTemplate="template",t.isUndefined="undefined"}(L||(L={})),t.fund=function(t,n={}){if(H(n))return $(t,n);if(void 0===t)throw e(y);return function(t){if("string"==typeof t)return T(t).toString();if(j(t))return A(t).toString();throw e(w)}(t)},t.getCurrentPointerAddress=function(){if(H()){const t=document.head.querySelectorAll('meta[name="monetization"]');if(t.length>1)throw e(c);if(t[0])return t[0].content;throw e(d)}if(N)return N.toString();throw e(i)},t.getCurrentPointerPool=function(){return function(t){return Array.isArray(t)||(t=[t]),t}(N)},t.setDefaultAddress=function(t,n={}){if(Array.isArray(t)){if(t.length)return void(P=b(t));throw e(a)}if("string"!=typeof t)if(O(t))P=S(t);else{if(!n.allowUndefined||void 0!==t)throw e(s);P=void 0}else P=t},Object.defineProperty(t,"__esModule",{value:!0})});