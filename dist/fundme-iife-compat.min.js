"use strict";function _toConsumableArray(t){if(Array.isArray(t)){for(var n=0,r=Array(t.length);n<t.length;n++)r[n]=t[n];return r}return Array.from(t)}var fundme=function(t){function n(t){return"Fundme.js: "+t}var r="address not found.",e="address must be a string.",i="can't use getCurrentPointerAddress() server-side.";var o="invalid Web Monetization pointer address is given.",a="default address not found. Use setDefaultAddress(str: string) to set it first.",u="invalid default address.",f="invalid default address.",s="can only clean custom syntax with typeof string.",d="web monetization meta tag is not found.",c='multiple <meta name="monetization" /> found - Web Monetization API only support a single meta tag.',l="no monetization template is found.",m="fails to parse address from <template data-fund></template>.",v="cannot parse JSON from <script fundme>. Make sure it contains a valid JSON.",h="found <script fundme> but it's not valid.",g='found <script fundme> but its type is not "application/json"',p="can't use fund() with empty parameters in server side.",y="invalid fundme parameters on the server-side.",w=5;function A(t){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},r=S(t),e=b(function(t){var n=function(t){return Math.random()*t}(function(t){var n=t.map(function(t){return t.weight});return Object.values(n).reduce(function(t,n){return t+n},0)}(t));return function(t,n){for(var r in t){var e=t[r].weight;if((n-=e)<=0)return t[r]}}(t,n)}(r));return P(r),L(n)?_(e):e}function b(t){var i=t.address;if(!i)throw n(r);if("string"!=typeof i)throw n(e);return i}function S(t){return t.map(function(t){if("string"==typeof t&&(t=z(t)),!q(t))throw n(r);return C(t)})}function C(t){return void 0!==t.weight&&NaN!==t.weight||(console.warn(t.address+" has weight that is not a number. It has been set to "+w+" (default)."),t.weight=w),t}function z(t){var n=t,r=void 0,e=t.split("#");return e.length>1&&(n=e[0],r=parseInt(e[1],10)),C({address:n,weight:r})}function M(t){return Array.isArray(t)}function _(t){return function(t,n){t?t.content=n:t=function(t){var n=document.createElement("meta");return n.name="monetization",n.content=t,document.head.appendChild(n),n}(n);return t}(document.querySelector('meta[name="monetization"]'),t)}function q(t){return!!t&&Object.keys(t).some(function(t){return"address"===t})}var j=void 0;function E(){return j}function N(t){return t}var O=void 0;function P(t){O=t}function D(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};return P(t=function(t){if("string"!=typeof t)throw n(s);return t=t.split("#")[0]}(t)),L(r)?_(t):t}var I="template[data-fund]",T="template[fundme]",W="script[fundme]";function F(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},r=[].concat(_toConsumableArray(function(){var t=document.body.querySelectorAll(I),r=[];t.length&&t.forEach(function(t){var e=function(t){var r=t.dataset.fund,e=void 0!==t.dataset.fundWeight?parseInt(t.dataset.fundWeight,0):w;if(!r)throw n(m);return C({address:r,weight:e})}(t);r=[].concat(_toConsumableArray(r),[e])});return r}()),_toConsumableArray(function(){var t=document.body.querySelectorAll(W),r=[];t.length&&t.forEach(function(t){r=function(t){var r=[],e=void 0;try{e=JSON.parse(t.innerHTML)}catch(t){throw n(v)}if("application/json"!==t.type)throw n(g);if(Array.isArray(e))r=S(e);else{if("string"!=typeof e)throw n(h);r=S([e])}return r}(t)});return r}()),_toConsumableArray(function(){var t=document.querySelectorAll(T),n=[];t.length&&t.forEach(function(t){n=[].concat(_toConsumableArray(n),_toConsumableArray(function(t){var n=[];return t.innerHTML.split(";").forEach(function(t){var r=t.replace(/(^\s+|\s+$)/g,"");r&&(n=[].concat(_toConsumableArray(n),[z(r)]))}),n}(t)))});return n}()));if(!r.length)throw n(l);A(r,t)}function J(t){var r,e=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if("string"==typeof t){if("default"===t){if(void 0!==E())return"string"==typeof E()?D(E().toString(),e):A(M(r=E())?r:[r],e),N(U.isDefault);throw n(a)}return D(t,e),N(U.isSingle)}if(M(t))return A(t,e),N(U.isMultiple);if(void 0===t)return F(),N(U.isFromTemplate);throw n(o)}var U,k=!1,H=void 0!==require&&void 0!==module,L=function(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};if("server"===t.force)return!1;var n=k;return k=!1,!H||n||"client"===t.force};return function(t){t.isSingle="single",t.isMultiple="multiple",t.isDefault="default",t.isFromTemplate="template",t.isUndefined="undefined"}(U||(U={})),t.fund=function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(L(r))return J(t,r);if(void 0===t)throw n(p);return function(t){if("string"==typeof t)return D(t).toString();if(M(t))return A(t).toString();throw n(y)}(t)},t.getCurrentPointerAddress=function(){if(L()){var t=document.head.querySelectorAll('meta[name="monetization"]');if(t.length>1)throw n(c);if(t[0])return t[0].content;throw n(d)}if(O)return O.toString();throw n(i)},t.getCurrentPointerPool=function(){return function(t){return Array.isArray(t)||(t=[t]),t}(O)},t.setDefaultAddress=function(t){var r=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};if(Array.isArray(t)){if(t.length)return void(j=S(t));throw n(f)}if("string"!=typeof t)if(q(t))j=b(t);else{if(!r.allowUndefined||void 0!==t)throw n(u);j=void 0}else j=t},t}({});
